# Сервис управления рассылками сообщений, администрирования и получения статистики по ним


[1. Цель проекта](#title1) / 
[2. Шаблоны страниц](#title2) / 
[3. Модели](#title3) / 
[4. Админки](#title4) / 
[5. Формы](#title5) / 
[6. Контроллеры](#title6) / 

[8. Установка проекта](#title8) / 
[9. Получение ключей .env](#title9) / 
[10. Описание файла .flake8](#title10) / 
[11. Описание файла mypy.ini](#title11) / 
[12. Описание директории Data](#title12) / 




# <a id="title1">1. Цель проекта</a>
Чтобы удержать текущих клиентов бизнеса, часто используются вспомогательные, или "прогревающие" рассылки для информирования и привлечения.

Необходимо создать веб-приложение на Django, которое позволяет пользователям управлять рассылками сообщений для клиентов. Приложение включает функциональность для создания, просмотра, редактирования и удаления рассылок, а также отправки сообщений по требованию.




# <a id="title2">2. Шаблоны html-страниц (templates)</a>

## _Приложение "app_mailing" (app_mailing/templates/):_

Реализованы следующие HTML-страницы:

1) `Шаблонные страницы`
   - ***base.html***: общий (базовый) шаблон для всех пользовательских страниц, который включает общие элементы страницы, такие как:
     - подключение всплывающих уведомлений для пользователей с информированием об успешной отправке различных форм (например, добавили нового клиента или удалили рассылку и так далее).
     - подключение подшаблона с меню (верхняя часть с навигацией).
     - подключение основного контента страницы.
     - подключение нижней части с футером (подвал).
     - подключение статичеcких файлов со стилями и скриптами Bootstrap.
     - инициализирование tooltip (и popover) в "mailing_list.html", чтоб для Получателей отображалось "количество" и "тултип с ФИО" (при наведении отображаю ФИО получателей).
   - ***menu.html***: подшаблон, в котором описано главное меню:
     - ссылки для всех пользовательских страниц (навигация между разделами магазина).
     - блок с кнопками аутентификации ("Регистрация", "Войти", "Выйти", "Редактировать профиль", "Изменить пароль") и логикой их отображения в зависимости от текущего состояния пользователя (авторизован или нет).


2) `Пользовательские страницы для "Управление клиентами"`
   - ***recipient_list.html***: страница для *отображения списка* Получателей в сервисе управления рассылками (модель данных **Recipient**).
     - Функционал страницы:
       - Переход на страницу добавления нового получателя.
       - Переход на страницу редактирования получателя.
       - Переход на страницу удаления получателя.
   - ***recipient_add_update.html***: страница для *добавления* нового или *обновления* существующего Получателя рассылки (модель данных **Recipient**).
     - Функционал страницы:
       - Добавить\Редактировать получателя.
       - Вернуться на страницу списка получателей.
   - ***recipient_delete.html***: страница для *удаления* Получателя рассылки (модель данных **Recipient**).
     - Функционал страницы:
       - Удаление получателя.
       - Вернуться на страницу списка получателей.


3) `Пользовательские страницы для "Управление сообщениями"`
   - ***message_list.html***: страница для *отображения списка* Сообщений в сервисе управления рассылками (модель данных **Message**).
     - Функционал страницы:
       - Переход на страницу добавления нового сообщения.
       - Переход на страницу редактирования сообщения.
       - Переход на страницу удаления сообщения.
   - ***message_add_update.html***: страница для *добавления* нового или *обновления* существующего Сообщения рассылки (модель данных **Message**).
     - Функционал страницы:
       - Добавить\Редактировать сообщение.
       - Вернуться на страницу списка сообщений.
   - ***message_delete.html***: страница для *удаления* Сообщения рассылки (модель данных **Message**).
     - Функционал страницы:
       - Удаление сообщения.
       - Вернуться на страницу списка сообщений.


4) `Пользовательские страницы для "Управление рассылками"`
   - ***mailing_list.html***: страница для *отображения списка* Рассылок в сервисе управления рассылками (модель данных **Mailing**).
     - Функционал страницы:
       - Переход на страницу добавления новой рассылки.
       - Переход на страницу редактирования рассылки.
       - Переход на страницу удаления рассылки.
       - ЗАПУСК рассылки.
   - ***mailing_add_update.html***: страница для *добавления* новой или *обновления* существующей Рассылки (модель данных **Mailing**).
     - Функционал страницы:
       - Добавить\Редактировать рассылку.
       - Вернуться на страницу списка рассылок.
   - ***mailing_delete.html***: страница для *удаления* Рассылки (модель данных **Mailing**).
     - Функционал страницы:
       - Удаление рассылки.
       - Вернуться на страницу списка рассылок.




# <a id="title3">3. Описание моделей (models)</a>

## _Приложение "app_mailing" (app_mailing/models.py):_

1) Модель данных `Recipient(models.Model)` - представляет "Получателя рассылки" в сервисе управления рассылками.
   - ***Поля модели:***
     - Почта получателя (email).
     - Ф.И.О. получателя (full_name).
     - Комментарий (comment).


2) Модель данных `Message(models.Model)` - представляет "Сообщение рассылки" в сервисе управления рассылками.
   - ***Поля модели:***
     - Тема письма (message_subject).
     - Тело письма (message_body).


3) Модель данных `Mailing(models.Model)` - представляет "Рассылку" в сервисе управления рассылками.
   - ***Поля модели:***
     - Дата и время первой отправки (first_message_sending).
     - Дата и время окончания отправки (end_message_sending).
     - Статус рассылки (status):
       - Доступные варианты статусов:
         - *Создана* - рассылка была создана, но еще ни разу не была отправлена.
         - *Запущена* - рассылка активна и была отправлена хотя бы один раз.
         - *Завершена* - время окончания отправки рассылки прошло.
     - Сообщение для рассылки (message) - внешний ключ на модель "Сообщение" (*models.ForeignKey(to=Message)*).
     - Получатели для рассылки (mailing_recipients) - "многие ко многим", связь с моделью "Получатель" (*models.ManyToManyField(to=Recipient)*).




# <a id="title4">4. Описание админок (admin)</a>

## _Приложение "app_mailing" (app_mailing/admin.py):_

1) Админка `RecipientAdmin(admin.ModelAdmin)` - отображение данных "Получатель рассылки" в админке (модель *Recipient*).


2) Админка `MessageAdmin(admin.ModelAdmin)` - отображение данных "Сообщение рассылки" в админке (модель *Message*).


3) Админка `MailingAdmin(admin.ModelAdmin)` - отображение данных "Рассылка" в админке (модель *Mailing*).




# <a id="title5">5. Описание форм (forms)</a>

## _Приложение "app_mailing" (app_mailing/forms.py):_

1) `AddNewRecipientForm(forms.ModelForm)` - форма для добавления пользователем нового *Получателя рассылки* на странице **recipient_add_update.html**
   - ***Кастомизация формы***:
     - `def __init__()` - стилизации полей формы с использованием виджета. Виджеты позволяют настроить внешний вид и поведение полей формы через атрибуты. Это делается с помощью метода attrs.
       - Добавляем CSS-классы ко всем полям формы.
       - Убираем параметр 'help_text' со всех полей, чтоб этого больше не было по умолчанию на html-странице.


2) `AddNewMessageForm(forms.ModelForm)` - форма для добавления пользователем нового *Сообщения рассылки* на странице **message_add_update.html**
   - ***Кастомизация формы***:
     - `def __init__()` - стилизации полей формы с использованием виджета. Виджеты позволяют настроить внешний вид и поведение полей формы через атрибуты. Это делается с помощью метода attrs.
       - Добавляем CSS-классы ко всем полям формы.
       - Убираем параметр 'help_text' со всех полей, чтоб этого больше не было по умолчанию на html-странице.


3) `AddNewMailingForm(forms.ModelForm)` - форма для добавления пользователем новой *Рассылки* на странице **mailing_add_update.html**
   - ***Кастомизация формы***:
     - `def __init__()` - стилизации полей формы с использованием виджета. Виджеты позволяют настроить внешний вид и поведение полей формы через атрибуты. Это делается с помощью метода attrs.
       - Добавляем CSS-классы ко всем полям формы.
       - Убираем параметр 'help_text' со всех полей, чтоб этого больше не было по умолчанию на html-странице.
       - Переопределяем отображение объектов в select-е, чтоб не выводился из модели текст *"Тема письма:"* в f"Тема письма: {self.message_subject}"




# <a id="title6">6. Описание контроллеров (views)</a>

## _Приложение "app_mailing" (app_mailing/views.py):_

### _1. Управление клиентами_

1) Класс-контроллер `RecipientListView(generic.ListView)` - представление для отображения списка *Получателей* рассылки.
   - ***Кастомизация контроллера***:
     - `def get_queryset(self)` - метод для сортировки на странице *Получателей* по ФИО (в алфавитном порядке).


2) Класс-контроллер `RecipientCreateView(generic.CreateView)` - представление для добавления нового *Получателя* рассылки.
   - ***Кастомизация контроллера***:
     - form_class = AddNewRecipientForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном добавлении нового *Получателя* в список рассылки.


3) Класс-контроллер `RecipientUpdateView(generic.UpdateView)` - представление для редактирования существующего *Получателя* рассылки.
   - ***Кастомизация контроллера***:
     - form_class = AddNewRecipientForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном редактировании данных *Получателя* из списка рассылки.


4) Класс-контроллер `RecipientDeleteView(generic.DeleteView)` - представление для удаления *Получателя* рассылки.
   - ***Кастомизация контроллера***:
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном удалении *Получателя* из списка рассылки.

### _2. Управление сообщениями_

1) Класс-контроллер `MessageListView(generic.ListView)` - представление для отображения списка *Сообщений* для рассылок.


2) Класс-контроллер `MessageCreateView(generic.CreateView)` - представление для добавления нового *Сообщения* рассылки.
   - ***Кастомизация контроллера***:
     - form_class = AddNewMessageForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном добавлении нового *Сообщения* в список рассылки.


3) Класс-контроллер `MessageUpdateView(generic.UpdateView)` - представление для редактирования существующего *Сообщения* рассылки.
   - ***Кастомизация контроллера***:
     - form_class = AddNewMessageForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном редактировании данных *Сообщения* из списка рассылки.


4) Класс-контроллер `MessageDeleteView(generic.DeleteView)` - представление для удаления *Сообщения* рассылки.
   - ***Кастомизация контроллера***:
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном удалении *Сообщения* из списка рассылки.

### _3. Управление рассылками_

1) Класс-контроллер `MailingListView(generic.ListView)` - представление для отображения списка *Рассылок*.
   - ***Кастомизация контроллера***:
     - `def get_queryset(self)` - метод для сортировки на странице *Рассылок* по их статусу: запущена → создана → завершена, внутри по дате окончания.


2) Класс-контроллер `MailingCreateView(generic.CreateView)` - представление для добавления новой *Рассылки*.
   - ***Кастомизация контроллера***:
     - form_class = AddNewMailingForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном добавлении новой *Рассылки* в список.


3) Класс-контроллер `MailingUpdateView(generic.UpdateView)` - представление для редактирования существующей *Рассылки*.
   - ***Кастомизация контроллера***:
     - form_class = AddNewMailingForm.
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном редактировании данных *Рассылки* из списка.


4) Класс-контроллер `MailingDeleteView(generic.DeleteView)` - представление для удаления *Рассылки*.
   - ***Кастомизация контроллера***:
     - `def form_valid(self, form)` - метод отправки пользователю уведомления об успешном удалении *Рассылки* из списка.


5) Класс-контроллер `SendMailingView(generic.View)` - представление для запуска выбранной пользователем *Рассылки* вручную через интерфейс.
   - ***Кастомизация контроллера***:
     - `def post(self, request, pk)` - метод отправки email всем получателям в выбранной *Рассылке*.




# <a id="title8">8. Установка проекта</a>

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/MaksimLakovich/Coursework-4-Mailing-management-service.git
   ```
2. Установите зависимости:
   ```
   poetry install
   ```
3. Заполните файл `.env` по примеру `.env.example`




# <a id="title9">9. Получение ключей. Описание файла .env.example</a> 

1. Создайте файл .env в корне проекта из копии подготовленного файла `.env.example`, в котором описаны названия всех переменных, необходимых для работы приложения.
2. Замените значения переменных реальными данными.
3. В модуле `settings.py` существует секретный ключ `SECRET_KEY`, который рекомендуется в целях безопасности хранить в тайне:
4. Файл .env должен содержать данные:
```dotenv
# Настройки секретного ключа проекта django в config/settings.py
#Django рекомендует в целях безопасности хранить секретный ключ, используемый в продакшене, в тайне!
SECRET_KEY_FOR_PROJECT=secret_key_here

# Настройки дебага.
# В settings.py дебаг должен быть описан так: DEBUG = True if os.getenv('DEBUG') == 'True' else False
DEBUG=

# Настройки БД проекта django в config/settings.py
DATABASE_NAME=
DATABASE_USER=
DATABASE_PASSWORD=
DATABASE_HOST=
DATABASE_PORT=

# Настройка SMTP-сервера Яндекса для отправки уведомлений пользователям магазина по почте:
YANDEX_EMAIL_HOST_USER=''
YANDEX_EMAIL_HOST_PASSWORD=''
```




# <a id="title10">10. Описание файла .flake8</a> 

```ini
[flake8]
max-line-length = 119
ignore = E203, W503
exclude = .git, __pycache__, venv, .venv
```




# <a id="title11">11. Описание файла mypy.ini</a> 

```ini
[mypy]
ignore_missing_imports = True
```




# <a id="title12">12. Описание директории data/</a> 

- Папка ***data/fixtures/***:
  - файл `add_recipients.json` - фикстура с тестовыми получателями для рассылок.
  - файл `add_messages.json` - фикстура с тестовыми сообщениями для рассылок.
  - файл `add_mailings.json` - фикстура с тестовыми рассылками.